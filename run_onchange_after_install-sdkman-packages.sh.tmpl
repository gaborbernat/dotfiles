#!/bin/bash
# sdkman packages hash: {{ include "dot_sdkman_packages.txt" | sha256sum }}
set -euo pipefail

export SDKMAN_DIR="$(brew --prefix sdkman-cli 2>/dev/null)/libexec" || true
SDKMAN_INIT="${SDKMAN_DIR}/bin/sdkman-init.sh"

if [[ ! -f "$SDKMAN_INIT" ]]; then
    echo "SDKMAN not initialized, skipping"
    exit 0
fi

source "$SDKMAN_INIT"

echo "Installing SDKMAN packages..."
while read -r candidate version; do
    [[ -z "$candidate" || "$candidate" == \#* ]] && continue
    if ! sdk list "$candidate" 2>/dev/null | grep -q "installed.*$version"; then
        echo "Installing $candidate $version..."
        sdk install "$candidate" "$version" < /dev/null || true
    fi
done < "$HOME/.sdkman_packages.txt"
echo "SDKMAN packages installed"
