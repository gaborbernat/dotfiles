# user specific configuration
$ENV:PYTHONIOENCODING = "UTF-8"

Clear-Host
Set-Alias -Name ls -Value lsd
Set-Alias -Name g -Value git
Set-Alias -Name rmi -Value Remove-Item
Set-Alias -Name gr -Value Select-String
Set-Alias -Name open -Value ii
{{ if eq .chezmoi.os "windows" -}}
function t {
    git diff HEAD
}
{{ else -}}
Set-Alias -Name t -Value tig
{{ end -}}

$ENV:PATH = (
    "$HOME/.local/bin",
    "$HOME/.cargo/bin",
    "$HOME/go/bin",
    {{ if ne .chezmoi.os "windows" -}}
    "/usr/local/bin",
    {{ end -}}
    $ENV:PATH
) -join ":"
$ENV:EDITOR = "nvim"

function ic {
    # shortcut for imgcat
    wezterm imgcat $args
}
# Autocomplete tab
Set-PSReadlineKeyHandler -Key Tab -Function MenuComplete
Set-PSReadlineKeyHandler -Key UpArrow -Function HistorySearchBackward
Set-PSReadlineKeyHandler -Key DownArrow -Function HistorySearchForward

Invoke-Expression (&starship init powershell)
Invoke-Expression (& { (lua "$HOME/git/github/z.lua/z.lua" --init powershell) -join "`n" })

$PromptScript = (Get-Item function:Prompt).ScriptBlock
function Prompt {
    $PreservedExitStatus = $? # Before doing anything else, capture current $?
    $CurrentWorkingDirectory = Split-Path -Path ((Get-Location).Path.Replace($Env:USER, "~")) -Leaf
    $Host.UI.RawUI.WindowTitle = "$CurrentWorkingDirectory"
    if ($? -ne $PreservedExitStatus) { 
        Write-Error "" -ErrorAction Ignore # Powershell 7+     
    }
    Invoke-Command $PromptScript
}

